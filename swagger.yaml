openapi: 3.0.3
info:
  title: ChitWise API
  description: |
    ChitWise is a comprehensive chit fund management system with role-based access control.
    
    ## User Roles
    
    ### Super Admin (`SUPER_ADMIN`)
    - Has complete system-wide access
    - Can manage all organisations, users, and data across the platform
    - Can create and manage Organisation Admins
    - Has access to all chit groups, members, collections, and reports
    
    ### Organisation Admin (`ORG_ADMIN`)
    - Has access scoped to their assigned organisation only
    - Can manage chit groups, members, and collections within their organisation
    - Cannot access other organisations' data
    - Cannot manage users or create new organisations
    
    ## Authentication
    All API endpoints (except login and seed) require authentication via JWT token stored in an HTTP-only cookie named `token`.
    
  version: 1.0.0
  contact:
    name: ChitWise Support
  license:
    name: MIT

servers:
  - url: http://localhost:3000/api
    description: Development server
  - url: https://chitwise-new.vercel.app/api
    description: Production server

tags:
  # =====================================================
  # üîì PUBLIC ENDPOINTS (No Authentication Required)
  # =====================================================
  - name: üîì Public - üîì Public - Authentication
    description: |
      **Access Level: PUBLIC**
      
      These endpoints are accessible without authentication.
      Used for logging in and seeding initial data.

  # =====================================================
  # üëë SUPER ADMIN ONLY ENDPOINTS
  # =====================================================
  - name: üëë Super Admin - User Management
    description: |
      **Access Level: SUPER ADMIN ONLY**
      
      ‚ö†Ô∏è These endpoints are restricted to Super Admin users only.
      Org Admins will receive a 403 Forbidden error if they attempt to access these.
      
      - Create, update, delete user accounts
      - Assign users to organisations
      - Manage user roles and permissions
      
  - name: üëë Super Admin - Organisation Management
    description: |
      **Access Level: SUPER ADMIN ONLY**
      
      ‚ö†Ô∏è These endpoints are restricted to Super Admin users only.
      Org Admins will receive a 403 Forbidden error if they attempt to access these.
      
      - Create, update, delete organisations
      - Manage organisation settings and details
      - View all organisations in the system

  # =====================================================
  # üè¢ ORG ADMIN ENDPOINTS (Core Operations)
  # =====================================================
  - name: üè¢ Org Admin - üè¢ Org Admin - Chit Groups
    description: |
      **Access Level: ORG ADMIN & SUPER ADMIN**
      
      ‚úÖ Org Admins can use these endpoints (scoped to their organisation only).
      Super Admins can access all organisations' data.
      
      - Create, update, delete chit groups
      - Manage group settings and schedules
      - View group details and status
      
  - name: üè¢ Org Admin - üè¢ Org Admin - Members
    description: |
      **Access Level: ORG ADMIN & SUPER ADMIN**
      
      ‚úÖ Org Admins can use these endpoints (scoped to their organisation only).
      Super Admins can access all organisations' data.
      
      - Register new members
      - Update member information
      - Manage member status and KYC
      
  - name: üè¢ Org Admin - Group Members (Subscriptions)
    description: |
      **Access Level: ORG ADMIN & SUPER ADMIN**
      
      ‚úÖ Org Admins can use these endpoints (scoped to their organisation only).
      Super Admins can access all organisations' data.
      
      - Add members to chit groups
      - Manage subscription units and patterns
      - Track member participation
      
  - name: üè¢ Org Admin - üè¢ Org Admin - Collections
    description: |
      **Access Level: ORG ADMIN & SUPER ADMIN**
      
      ‚úÖ Org Admins can use these endpoints (scoped to their organisation only).
      Super Admins can access all organisations' data.
      
      - Record payment collections
      - Track dues and payments
      - Manage collection schedules
      
  - name: üè¢ Org Admin - Winners (Draws)
    description: |
      **Access Level: ORG ADMIN & SUPER ADMIN**
      
      ‚úÖ Org Admins can use these endpoints (scoped to their organisation only).
      Super Admins can access all organisations' data.
      
      - Record draw winners
      - Manage prize payouts
      - Track lottery/auction results
      
  - name: üè¢ Org Admin - üè¢ Org Admin - Dashboard
    description: |
      **Access Level: ORG ADMIN & SUPER ADMIN**
      
      ‚úÖ Org Admins can use these endpoints (scoped to their organisation only).
      Super Admins can access all organisations' data.
      
      - View dashboard statistics
      - Quick overview of key metrics
      
  - name: üè¢ Org Admin - üè¢ Org Admin - Reports
    description: |
      **Access Level: ORG ADMIN & SUPER ADMIN**
      
      ‚úÖ Org Admins can use these endpoints (scoped to their organisation only).
      Super Admins can access all organisations' data.
      
      - Analytics and trend reports
      - Collection reports
      - Performance metrics

  # =====================================================
  # üîß UTILITY ENDPOINTS
  # =====================================================
  - name: üîß System Utilities
    description: |
      **Access Level: VARIES**
      
      System utility endpoints for seeding data and maintenance.

components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: token
      description: JWT token stored in HTTP-only cookie

  schemas:
    # =====================================================
    # USER SCHEMAS
    # =====================================================
    User:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439011"
        email:
          type: string
          format: email
          example: "admin@example.com"
        name:
          type: string
          example: "John Doe"
        role:
          type: string
          enum: [SUPER_ADMIN, ORG_ADMIN]
          example: "ORG_ADMIN"
        organisationId:
          type: string
          description: Required for ORG_ADMIN users
          example: "507f1f77bcf86cd799439012"
        status:
          type: string
          enum: [ACTIVE, INACTIVE]
          example: "ACTIVE"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateUserRequest:
      type: object
      required:
        - name
        - email
        - password
      properties:
        name:
          type: string
          example: "John Doe"
        email:
          type: string
          format: email
          example: "john@example.com"
        password:
          type: string
          minLength: 6
          example: "securePassword123"
        role:
          type: string
          enum: [SUPER_ADMIN, ORG_ADMIN]
          default: "ORG_ADMIN"
        organisationId:
          type: string
          description: Required when role is ORG_ADMIN
          example: "507f1f77bcf86cd799439012"

    UpdateUserRequest:
      type: object
      properties:
        name:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 6
        role:
          type: string
          enum: [ORG_ADMIN]
          description: Cannot promote to SUPER_ADMIN
        organisationId:
          type: string
        status:
          type: string
          enum: [ACTIVE, INACTIVE]

    # =====================================================
    # ORGANISATION SCHEMAS
    # =====================================================
    Organisation:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439012"
        name:
          type: string
          example: "ABC Chit Funds"
        code:
          type: string
          example: "ABC001"
        description:
          type: string
          example: "Leading chit fund company"
        address:
          type: string
          example: "123 Main Street, Chennai"
        phone:
          type: string
          example: "+91-9876543210"
        email:
          type: string
          format: email
          example: "info@abcchits.com"
        gstNumber:
          type: string
          example: "33AABCS1429B1Z4"
        panNumber:
          type: string
          example: "AABCS1429B"
        logo:
          type: string
          example: "https://example.com/logo.png"
        status:
          type: string
          enum: [ACTIVE, INACTIVE]
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateOrganisationRequest:
      type: object
      required:
        - name
        - code
      properties:
        name:
          type: string
          example: "ABC Chit Funds"
        code:
          type: string
          example: "ABC001"
        description:
          type: string
        address:
          type: string
        phone:
          type: string
        email:
          type: string
          format: email
        gstNumber:
          type: string
        panNumber:
          type: string
        logo:
          type: string

    UpdateOrganisationRequest:
      type: object
      properties:
        name:
          type: string
        code:
          type: string
        description:
          type: string
        address:
          type: string
        phone:
          type: string
        email:
          type: string
          format: email
        gstNumber:
          type: string
        panNumber:
          type: string
        logo:
          type: string
        status:
          type: string
          enum: [ACTIVE, INACTIVE]

    # =====================================================
    # CHIT GROUP SCHEMAS
    # =====================================================
    ChitGroup:
      type: object
      description: |
        A Chit Group represents a savings scheme where members contribute a fixed amount periodically.
        
        ## Business Logic
        - **Prize Pool**: `contributionAmount √ó totalUnits` = Total amount collected per period
        - **Winner Payout**: Prize Pool - Commission = Amount winner receives
        - **Total Chit Value**: `contributionAmount √ó totalUnits √ó totalPeriods`
        - **Current Period**: Auto-calculated based on `startDate` and `frequency`
        
        ## Example Calculation
        For a group with `contributionAmount=2000`, `totalUnits=52`, `commissionValue=4000`:
        - Per period collection: 2000 √ó 52 = ‚Çπ1,04,000
        - Winner receives: 1,04,000 - 4,000 = ‚Çπ1,00,000
      properties:
        _id:
          type: string
          description: MongoDB ObjectId - unique identifier
          example: "507f1f77bcf86cd799439013"
        groupName:
          type: string
          description: |
            Unique identifier name for the group. 
            Common naming convention: `{TotalPeriods}{Frequency}-{ContributionAmount}-{Year}`
          example: "52W-2000-2024"
        description:
          type: string
          description: Optional descriptive text about the group
          example: "Weekly chit group for 52 weeks starting January 2024"
        frequency:
          type: string
          enum: [DAILY, WEEKLY, MONTHLY]
          description: |
            How often a draw is conducted:
            - **DAILY**: Draw happens every day
            - **WEEKLY**: Draw happens once a week
            - **MONTHLY**: Draw happens once a month
          example: "WEEKLY"
        contributionAmount:
          type: number
          description: |
            Amount each member must pay per period PER UNIT.
            
            **Formula**: `contributionAmount √ó units = Member's payment per period`
            
            Example: If contributionAmount=2000 and member has 2 units, they pay ‚Çπ4000/period
          minimum: 1
          example: 2000
        totalUnits:
          type: integer
          description: |
            Total number of subscription units available in this group.
            
            - Usually equals `totalPeriods` (one winner per period)
            - Can be split among members (e.g., 0.5 units, 1.5 units)
            - Each unit entitles member to participate in draws proportionally
          minimum: 1
          example: 52
        totalPeriods:
          type: integer
          description: |
            Total number of periods (draws) in the chit cycle.
            
            - WEEKLY groups: Usually 52 periods (1 year)
            - MONTHLY groups: Usually 12 or 24 periods
            - Each period has exactly one draw/winner
          minimum: 1
          example: 52
        commissionValue:
          type: number
          description: |
            Fixed commission amount deducted from prize pool each period.
            
            **Winner Payout Formula**: `(contributionAmount √ó totalUnits) - commissionValue`
            
            This is the organizer's earning per draw.
          minimum: 0
          example: 4000
        allowCustomCollectionPattern:
          type: boolean
          default: false
          description: |
            If true, members can choose their own collection schedule (DAILY/WEEKLY/MONTHLY).
            If false, all members follow the group's frequency.
            
            Example: A MONTHLY group might allow WEEKLY collections for convenience.
        subscriptionAmount:
          type: number
          description: |
            One-time joining fee charged when a member subscribes.
            Optional - set to 0 or omit if not applicable.
          example: 500
        subscriptionFrequency:
          type: string
          enum: [DAILY, WEEKLY, MONTHLY]
          description: |
            Frequency for collecting subscription amount.
            Usually same as `frequency`, but can differ for custom patterns.
        startDate:
          type: string
          format: date-time
          description: |
            Date when the first period begins.
            
            - Current period is auto-calculated based on this date
            - End date is auto-calculated: `startDate + (totalPeriods √ó frequency interval)`
          example: "2024-01-01T00:00:00.000Z"
        endDate:
          type: string
          format: date-time
          description: |
            Auto-calculated end date of the chit cycle.
            
            **Calculation**: `startDate + (totalPeriods - 1) √ó frequency_interval`
          example: "2024-12-30T00:00:00.000Z"
        currentPeriod:
          type: integer
          default: 1
          description: |
            Current active period number (1-indexed).
            
            **Auto-calculated** based on current date and start date:
            - DAILY: Days since startDate + 1
            - WEEKLY: Weeks since startDate + 1
            - MONTHLY: Months since startDate + 1
            
            Cannot exceed `totalPeriods`.
          minimum: 1
          example: 15
        status:
          type: string
          enum: [ACTIVE, CLOSED, SUSPENDED]
          description: |
            **ACTIVE**: Group is running, collections and draws happening
            **CLOSED**: All periods completed, no more activity
            **SUSPENDED**: Temporarily paused (e.g., disputes, holidays)
          example: "ACTIVE"
        organisationId:
          type: string
          description: |
            Reference to the organisation this group belongs to.
            
            - ORG_ADMIN: Auto-set from user's organisation
            - SUPER_ADMIN: Must provide explicitly
          example: "507f1f77bcf86cd799439012"
        createdAt:
          type: string
          format: date-time
          description: Timestamp when group was created
        updatedAt:
          type: string
          format: date-time
          description: Timestamp of last update

    CreateChitGroupRequest:
      type: object
      required:
        - groupName
        - frequency
        - contributionAmount
        - totalUnits
        - totalPeriods
        - commissionValue
        - startDate
      properties:
        groupName:
          type: string
          example: "52W-2000-2024"
        description:
          type: string
        frequency:
          type: string
          enum: [DAILY, WEEKLY, MONTHLY]
        contributionAmount:
          type: number
        totalUnits:
          type: integer
        totalPeriods:
          type: integer
        commissionValue:
          type: number
        allowCustomCollectionPattern:
          type: boolean
        subscriptionAmount:
          type: number
        subscriptionFrequency:
          type: string
          enum: [DAILY, WEEKLY, MONTHLY]
        startDate:
          type: string
          format: date-time
        organisationId:
          type: string
          description: Required for SUPER_ADMIN, auto-set for ORG_ADMIN

    UpdateChitGroupRequest:
      type: object
      properties:
        groupName:
          type: string
        description:
          type: string
        frequency:
          type: string
          enum: [DAILY, WEEKLY, MONTHLY]
        contributionAmount:
          type: number
        totalUnits:
          type: integer
        totalPeriods:
          type: integer
        commissionValue:
          type: number
        allowCustomCollectionPattern:
          type: boolean
        subscriptionAmount:
          type: number
        subscriptionFrequency:
          type: string
          enum: [DAILY, WEEKLY, MONTHLY]
        startDate:
          type: string
          format: date-time
        status:
          type: string
          enum: [ACTIVE, CLOSED, SUSPENDED]

    # =====================================================
    # MEMBER SCHEMAS
    # =====================================================
    Member:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439014"
        name:
          type: string
          example: "Ravi Kumar"
        phone:
          type: string
          example: "9876543210"
        email:
          type: string
          format: email
        address:
          type: string
        status:
          type: string
          enum: [ACTIVE, INACTIVE]
        kycVerified:
          type: boolean
          default: false
        organisationId:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateMemberRequest:
      type: object
      required:
        - name
        - phone
      properties:
        name:
          type: string
          example: "Ravi Kumar"
        phone:
          type: string
          example: "9876543210"
        email:
          type: string
          format: email
        address:
          type: string
        organisationId:
          type: string
          description: Required for SUPER_ADMIN, auto-set for ORG_ADMIN

    # =====================================================
    # GROUP MEMBER (SUBSCRIPTION) SCHEMAS
    # =====================================================
    GroupMember:
      type: object
      description: |
        A GroupMember represents a member's subscription to a specific chit group.
        One member can subscribe to multiple groups with different units.
        
        ## Business Logic
        
        ### Collection Pattern & Factor
        The `collectionFactor` determines how many times to collect per base period:
        
        | Group Frequency | Collection Pattern | Collection Factor |
        |-----------------|-------------------|-------------------|
        | MONTHLY | MONTHLY | 1 (collect once) |
        | MONTHLY | WEEKLY | 4 (collect 4 times) |
        | MONTHLY | DAILY | 30 (collect 30 times) |
        | WEEKLY | WEEKLY | 1 (collect once) |
        | WEEKLY | DAILY | 7 (collect 7 times) |
        
        ### Amount Calculations
        - **Payment per collection**: `(contributionAmount √ó units) / collectionFactor`
        - **Total Due**: `contributionAmount √ó units √ó currentPeriod`
        - **Pending Amount**: `totalDue - totalCollected`
        - **Overdue Amount**: Pending amounts from past periods (dynamically calculated)
        
        ### Example
        Member with 1.5 units in a ‚Çπ2000/unit MONTHLY group, collecting WEEKLY:
        - Monthly due: 2000 √ó 1.5 = ‚Çπ3,000
        - Weekly collection: 3000 / 4 = ‚Çπ750
      properties:
        _id:
          type: string
          description: MongoDB ObjectId - unique identifier for this subscription
          example: "507f1f77bcf86cd799439015"
        memberId:
          $ref: '#/components/schemas/Member'
          description: Reference to the subscribed member (populated with full member object)
        groupId:
          $ref: '#/components/schemas/ChitGroup'
          description: Reference to the chit group (populated with full group object)
        units:
          type: number
          description: |
            Number of units subscribed by this member.
            
            - Can be fractional (0.5, 1.5, etc.)
            - Determines payment amount and winning eligibility
            - Total units across all members should not exceed group's `totalUnits`
            
            **Payment Formula**: `contributionAmount √ó units = Payment per period`
          minimum: 0.1
          example: 1
        collectionPattern:
          type: string
          enum: [DAILY, WEEKLY, MONTHLY]
          description: |
            How often this member's payments are collected.
            
            - If `allowCustomCollectionPattern` is true, members can choose
            - If false, defaults to group's frequency
            
            **Use Case**: A MONTHLY group might allow WEEKLY collections 
            for members who prefer smaller, more frequent payments.
        collectionFactor:
          type: integer
          description: |
            Number of collection installments per base period.
            
            **Auto-calculated** based on group frequency and collection pattern:
            - MONTHLY group + WEEKLY collection = 4
            - WEEKLY group + DAILY collection = 7
            - Same frequency = 1
            
            Used to split period payment into smaller installments.
          example: 4
        joinDate:
          type: string
          format: date-time
          description: |
            Date when member joined this group.
            
            - Used to calculate dues (only periods after join date count)
            - Members joining mid-cycle pay proportionally
          example: "2024-01-15T00:00:00.000Z"
        totalDue:
          type: number
          description: |
            Total cumulative amount due from join date till current period.
            
            **Formula**: `contributionAmount √ó units √ó (currentPeriod - joinPeriod + 1)`
            
            Updates automatically as periods progress.
          example: 30000
        totalCollected:
          type: number
          description: |
            Sum of all payments made by this member for this subscription.
            
            - Updated when collections are recorded
            - Includes partial payments
          example: 25000
        pendingAmount:
          type: number
          description: |
            Amount still to be collected.
            
            **Formula**: `totalDue - totalCollected`
            
            This represents the member's outstanding balance.
          example: 5000
        overdueAmount:
          type: number
          description: |
            Amount overdue from previous periods (dynamically calculated).
            
            This is the portion of `pendingAmount` that was due in past periods
            but hasn't been collected yet.
            
            ‚ö†Ô∏è High overdue amounts may indicate defaulting members.
          example: 2000
        status:
          type: string
          enum: [ACTIVE, CLOSED, DEFAULTED]
          description: |
            **ACTIVE**: Member is currently participating, payments ongoing
            **CLOSED**: Subscription completed (all periods done or member exited)
            **DEFAULTED**: Member has stopped paying, flagged for action
          example: "ACTIVE"
        createdAt:
          type: string
          format: date-time
          description: Timestamp when subscription was created
        updatedAt:
          type: string
          format: date-time
          description: Timestamp of last update

    CreateGroupMemberRequest:
      type: object
      required:
        - groupId
        - memberId
        - units
        - collectionPattern
      properties:
        groupId:
          type: string
        memberId:
          type: string
        units:
          type: number
          example: 1
        collectionPattern:
          type: string
          enum: [DAILY, WEEKLY, MONTHLY]
        joinDate:
          type: string
          format: date-time

    # =====================================================
    # COLLECTION SCHEMAS
    # =====================================================
    Collection:
      type: object
      description: |
        A Collection record represents a single payment transaction from a member.
        
        ## Business Logic
        
        ### How Collections Work
        1. System generates expected collection records based on subscription
        2. When member pays, the collection is updated with payment details
        3. Partial payments are allowed (status = PARTIAL)
        4. Multiple collections can exist per period (based on collectionFactor)
        
        ### Collection Sequence
        For members with collection patterns different from group frequency:
        - BasePeriodNumber: The chit period (e.g., Period 5 of 52)
        - CollectionSequence: Which collection within that period (e.g., Week 2 of Month)
        
        ### Example
        Period 5 of a MONTHLY group with WEEKLY collection:
        - BasePeriodNumber: 5
        - CollectionSequence: 1, 2, 3, 4 (4 weekly collections in month 5)
        
        ### Status Flow
        ```
        PENDING ‚Üí PAID (full payment)
        PENDING ‚Üí PARTIAL (amount < due) ‚Üí PAID (remaining paid)
        PENDING/PARTIAL ‚Üí FAILED (payment failed/bounced)
        ```
      properties:
        _id:
          type: string
          description: MongoDB ObjectId - unique identifier for this collection
          example: "507f1f77bcf86cd799439016"
        groupMemberId:
          type: string
          description: |
            Reference to the GroupMember subscription.
            Use this to identify which member's subscription this payment belongs to.
          example: "507f1f77bcf86cd799439015"
        groupId:
          type: string
          description: Reference to the chit group (for quick filtering)
          example: "507f1f77bcf86cd799439013"
        memberId:
          type: string
          description: Reference to the member (for quick filtering)
          example: "507f1f77bcf86cd799439014"
        basePeriodNumber:
          type: integer
          description: |
            The chit group's period number this collection belongs to.
            
            - 1-indexed (Period 1, Period 2, ...)
            - Cannot exceed group's `totalPeriods`
            - Used to track which period's dues are being collected
          minimum: 1
          example: 5
        collectionSequence:
          type: integer
          description: |
            Sequence number within the base period.
            
            For same-frequency collections: always 1
            For different frequencies:
            - MONTHLY group + WEEKLY collection: 1-4
            - WEEKLY group + DAILY collection: 1-7
            
            **Formula**: Sequence ranges from 1 to `collectionFactor`
          minimum: 1
          example: 2
        periodDate:
          type: string
          format: date-time
          description: |
            The date this collection was due/scheduled.
            
            - Auto-calculated based on group startDate, period, and sequence
            - Used for overdue calculations
          example: "2024-02-15T00:00:00.000Z"
        amountDue:
          type: number
          description: |
            Amount that should be collected in this transaction.
            
            **Formula**: `(contributionAmount √ó units) / collectionFactor`
            
            Example: ‚Çπ3000/month √∑ 4 weeks = ‚Çπ750/week
          example: 750
        amountPaid:
          type: number
          description: |
            Actual amount received from the member.
            
            - Can be less than amountDue (partial payment)
            - Can equal amountDue (full payment)
            - Should not exceed amountDue
          example: 750
        paymentMode:
          type: string
          enum: [CASH, UPI, CHEQUE, BANK_TRANSFER]
          description: |
            Method of payment used:
            - **CASH**: Physical cash payment
            - **UPI**: Digital UPI payment (PhonePe, GPay, etc.)
            - **CHEQUE**: Cheque payment (may take time to clear)
            - **BANK_TRANSFER**: NEFT/IMPS/RTGS transfer
          example: "UPI"
        collectedBy:
          type: string
          description: |
            User ID of the person who recorded this collection.
            Automatically set to the logged-in user's ID.
          example: "507f1f77bcf86cd799439011"
        collectedAt:
          type: string
          format: date-time
          description: |
            Actual timestamp when payment was received.
            May differ from periodDate (scheduled date).
          example: "2024-02-16T14:30:00.000Z"
        remarks:
          type: string
          description: |
            Optional notes about this collection.
            Useful for recording special circumstances, reasons for delay, etc.
          example: "Paid via PhonePe, transaction ID: ABC123"
        status:
          type: string
          enum: [PENDING, PAID, PARTIAL, FAILED]
          description: |
            Collection status:
            - **PENDING**: Payment not yet received (default for scheduled collections)
            - **PAID**: Full payment received (amountPaid >= amountDue)
            - **PARTIAL**: Only partial amount received (amountPaid < amountDue)
            - **FAILED**: Payment failed (bounced cheque, reversed UPI, etc.)
          example: "PAID"
        createdAt:
          type: string
          format: date-time
          description: Timestamp when this collection record was created
        updatedAt:
          type: string
          format: date-time
          description: Timestamp of last update (e.g., when payment was recorded)

    CreateCollectionRequest:
      type: object
      required:
        - groupMemberId
        - basePeriodNumber
        - amountPaid
      properties:
        groupMemberId:
          type: string
        basePeriodNumber:
          type: integer
        amountPaid:
          type: number
        paymentMode:
          type: string
          enum: [CASH, UPI, CHEQUE, BANK_TRANSFER]
          default: CASH
        periodDate:
          type: string
          format: date-time
        remarks:
          type: string

    # =====================================================
    # WINNER SCHEMAS
    # =====================================================
    Winner:
      type: object
      description: |
        A Winner record represents the outcome of a draw for a specific period.
        Each period has exactly one draw, and one or more members can win.
        
        ## Business Logic
        
        ### Draw Process
        1. At the end of each period, a draw is conducted
        2. One member is selected (lottery) or wins bidding (auction)
        3. Winner receives the prize pool minus commission
        4. Winner record is created with payout details
        
        ### Prize Calculation
        ```
        Prize Pool = contributionAmount √ó totalUnits
        Commission = commissionValue (fixed per period)
        Winner Payout = Prize Pool - Commission
        ```
        
        ### Example
        For a group with `contributionAmount=2000`, `totalUnits=52`, `commissionValue=4000`:
        - Prize Pool: 2000 √ó 52 = ‚Çπ1,04,000
        - Winner receives: 1,04,000 - 4,000 = ‚Çπ1,00,000
        
        ### Selection Methods
        - **LOTTERY**: Random selection among eligible non-winners
        - **AUCTION**: Lowest bidder wins (offers discount = higher commission)
        
        ### Winning Units
        A member can win partially based on their subscribed units:
        - Member with 2 units can win 2 times (once per unit)
        - Or win both units in a single draw (winningUnits = 2)
      properties:
        _id:
          type: string
          description: MongoDB ObjectId - unique identifier for this winner record
          example: "507f1f77bcf86cd799439017"
        groupId:
          type: string
          description: Reference to the chit group where draw was conducted
          example: "507f1f77bcf86cd799439013"
        groupMemberId:
          type: string
          description: |
            Reference to the winning member's subscription.
            Identifies which subscription units won.
          example: "507f1f77bcf86cd799439015"
        memberId:
          type: string
          description: Reference to the winning member (for quick filtering)
          example: "507f1f77bcf86cd799439014"
        basePeriodNumber:
          type: integer
          description: |
            The period number for which this draw was conducted.
            
            - Each period has exactly one draw
            - Cannot be greater than group's `totalPeriods`
            - Used to ensure no duplicate draws for same period
          minimum: 1
          example: 15
        winningUnits:
          type: number
          description: |
            Number of units won in this draw.
            
            - Usually 1 (one unit per draw)
            - Can be higher if member wins multiple units at once
            - Cannot exceed member's remaining unwon units
            
            **Prize Scaling**: Prize is proportional to winning units
          minimum: 0.1
          example: 1
        prizeAmount:
          type: number
          description: |
            Amount to be paid to the winner.
            
            **Formula**: `(contributionAmount √ó totalUnits - commissionValue) √ó winningUnits`
            
            For auctions, this may be lower if winner offered a discount.
          example: 100000
        selectionMethod:
          type: string
          enum: [LOTTERY, AUCTION]
          description: |
            How the winner was selected:
            
            - **LOTTERY**: Random selection from eligible members
              - All non-winner members with unpaid units are eligible
              - Fair random selection
            
            - **AUCTION**: Bidding process
              - Members bid by offering to forgo part of prize (discount)
              - Highest discount bidder wins
              - Commission is higher in auctions (base + discount)
          example: "LOTTERY"
        commissionEarned:
          type: number
          description: |
            Commission earned by organizer from this draw.
            
            **For Lottery**: Equal to `commissionValue` from group
            **For Auction**: `commissionValue + winner's discount offer`
            
            Example: Base ‚Çπ4000 + Auction discount ‚Çπ2000 = ‚Çπ6000 earned
          example: 4000
        payoutDate:
          type: string
          format: date-time
          description: |
            Date when the prize was/will be paid to winner.
            
            - Can be set at draw time or updated later
            - Used for financial tracking and reports
          example: "2024-04-10T00:00:00.000Z"
        status:
          type: string
          enum: [PENDING, PAID, FORFEITED]
          description: |
            Payout status:
            
            - **PENDING**: Draw completed, payout not yet done
            - **PAID**: Prize amount has been paid to winner
            - **FORFEITED**: Winner forfeited prize (rare, usually due to default)
          example: "PAID"
        remarks:
          type: string
          description: |
            Optional notes about this draw or payout.
            Useful for recording auction details, payment references, etc.
          example: "Prize paid via bank transfer, Ref: NEFT123456"
        createdAt:
          type: string
          format: date-time
          description: Timestamp when draw was conducted
        updatedAt:
          type: string
          format: date-time
          description: Timestamp of last update (e.g., when payout was recorded)

    CreateWinnerRequest:
      type: object
      required:
        - groupId
        - groupMemberId
        - memberId
        - basePeriodNumber
        - winningUnits
        - prizeAmount
      properties:
        groupId:
          type: string
        groupMemberId:
          type: string
        memberId:
          type: string
        basePeriodNumber:
          type: integer
        winningUnits:
          type: number
        prizeAmount:
          type: number
        commissionEarned:
          type: number
        selectionMethod:
          type: string
          enum: [LOTTERY, AUCTION]
          default: LOTTERY
        status:
          type: string
          enum: [PENDING, PAID, FORFEITED]
          default: PENDING
        payoutDate:
          type: string
          format: date-time
        remarks:
          type: string

    # =====================================================
    # DASHBOARD & REPORTS SCHEMAS
    # =====================================================
    DashboardResponse:
      type: object
      properties:
        stats:
          type: object
          properties:
            activeGroups:
              type: integer
            totalCollections:
              type: number
            activeMembers:
              type: integer
            pendingDues:
              type: number
        recentCollections:
          type: array
          items:
            $ref: '#/components/schemas/Collection'
        pendingDuesList:
          type: array
          items:
            $ref: '#/components/schemas/GroupMember'

    ReportsResponse:
      type: object
      properties:
        trends:
          type: array
          description: "Collection trends for last 6 months"
          items:
            type: object
            properties:
              name:
                type: string
                example: "Jan"
              amount:
                type: number
        distribution:
          type: array
          description: "Member distribution across groups"
          items:
            type: object
            properties:
              name:
                type: string
              value:
                type: integer
        paymentModeStats:
          type: array
          description: "Collections by payment mode"
          items:
            type: object
            properties:
              name:
                type: string
              value:
                type: number
        recentTransactions:
          type: array
          items:
            $ref: '#/components/schemas/Collection'
        groupPerformance:
          type: array
          description: "Top 5 groups by collection amount"
          items:
            type: object
            properties:
              name:
                type: string
              value:
                type: number

    # =====================================================
    # ERROR SCHEMAS
    # =====================================================
    Error:
      type: object
      properties:
        error:
          type: string
          example: "Error message"
        details:
          type: string

security:
  - cookieAuth: []

paths:
  # =====================================================
  # AUTHENTICATION ENDPOINTS (ALL USERS)
  # =====================================================
  /auth/login:
    post:
      tags:
        - üîì Public - Authentication
      summary: User Login
      description: |
        Authenticate a user and receive a JWT token stored in an HTTP-only cookie.
        
        **Access:** Public (No authentication required)
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: "admin@gmail.com"
                password:
                  type: string
                  example: "Admin@123"
      responses:
        '200':
          description: Login successful
          headers:
            Set-Cookie:
              description: JWT token in HTTP-only cookie
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Login successful"
                  user:
                    type: object
                    properties:
                      id:
                        type: string
                      email:
                        type: string
                      name:
                        type: string
                      role:
                        type: string
                      status:
                        type: string
        '400':
          description: Missing credentials
        '401':
          description: Invalid email or password
        '403':
          description: Account deactivated

  /auth/logout:
    post:
      tags:
        - üîì Public - Authentication
      summary: User Logout
      description: |
        Logout the current user by clearing the authentication cookie.
        
        **Access:** All authenticated users
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Logout successful"

  /auth/me:
    get:
      tags:
        - üîì Public - Authentication
      summary: Get Current User
      description: |
        Retrieve the currently authenticated user's profile.
        
        **Access:** All authenticated users
      responses:
        '200':
          description: User data
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                  email:
                    type: string
                  name:
                    type: string
                  role:
                    type: string
                  status:
                    type: string
                  createdAt:
                    type: string
                    format: date-time
        '401':
          description: Unauthorized
        '403':
          description: Account inactive
        '404':
          description: User not found

  # =====================================================
  # SUPER ADMIN - USER MANAGEMENT
  # =====================================================
  /users:
    get:
      tags:
        - üëë Super Admin - User Management
      summary: List All Users
      description: |
        Retrieve all users in the system.
        
        **Access:** Super Admin Only
      responses:
        '200':
          description: List of users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden - Super Admin access required

    post:
      tags:
        - üëë Super Admin - User Management
      summary: Create New User
      description: |
        Create a new user account. When creating an ORG_ADMIN, an organisationId must be provided.
        
        **Access:** Super Admin Only
        
        **Note:** Cannot create another Super Admin user.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Missing required fields or duplicate email
        '401':
          description: Unauthorized
        '403':
          description: Forbidden - Super Admin access required

  /users/{id}:
    get:
      tags:
        - üëë Super Admin - User Management
      summary: Get User by ID
      description: |
        Retrieve a specific user by their ID.
        
        **Access:** Super Admin Only
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: User data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: User not found

    put:
      tags:
        - üëë Super Admin - User Management
      summary: Update User
      description: |
        Update an existing user's information.
        
        **Access:** Super Admin Only
        
        **Restrictions:**
        - Cannot modify a Super Admin user
        - Cannot promote a user to Super Admin
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden - Cannot modify Super Admin
        '404':
          description: User not found

    delete:
      tags:
        - üëë Super Admin - User Management
      summary: Delete User
      description: |
        Delete a user from the system.
        
        **Access:** Super Admin Only
        
        **Restriction:** Cannot delete a Super Admin user
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: User deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User deleted successfully"
        '401':
          description: Unauthorized
        '403':
          description: Forbidden - Cannot delete Super Admin
        '404':
          description: User not found

  # =====================================================
  # SUPER ADMIN - ORGANISATION MANAGEMENT
  # =====================================================
  /organisations:
    get:
      tags:
        - üëë Super Admin - Organisation Management
      summary: List All Organisations
      description: |
        Retrieve all organisations in the system.
        
        **Access:** Super Admin Only
      responses:
        '200':
          description: List of organisations
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Organisation'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden - Super Admin access required

    post:
      tags:
        - üëë Super Admin - Organisation Management
      summary: Create New Organisation
      description: |
        Create a new organisation.
        
        **Access:** Super Admin Only
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrganisationRequest'
      responses:
        '201':
          description: Organisation created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Organisation'
        '400':
          description: Creation failed
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /organisations/{id}:
    get:
      tags:
        - üëë Super Admin - Organisation Management
      summary: Get Organisation by ID
      description: |
        Retrieve a specific organisation by ID.
        
        **Access:** All authenticated users (Super Admin sees all, ORG_ADMIN can view their own)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Organisation data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Organisation'
        '401':
          description: Unauthorized
        '404':
          description: Organisation not found

    put:
      tags:
        - üëë Super Admin - Organisation Management
      summary: Update Organisation
      description: |
        Update an organisation's information.
        
        **Access:** All authenticated users (typically used by Super Admin)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateOrganisationRequest'
      responses:
        '200':
          description: Organisation updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  organisation:
                    $ref: '#/components/schemas/Organisation'
        '401':
          description: Unauthorized
        '404':
          description: Organisation not found

    delete:
      tags:
        - üëë Super Admin - Organisation Management
      summary: Delete Organisation
      description: |
        Delete an organisation from the system.
        
        **Access:** All authenticated users (typically restricted to Super Admin in practice)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Organisation deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  deletedOrganisationId:
                    type: string
        '401':
          description: Unauthorized
        '404':
          description: Organisation not found

  # =====================================================
  # CHIT GROUPS (BOTH ROLES - SCOPED)
  # =====================================================
  /chitgroups:
    get:
      tags:
        - üè¢ Org Admin - Chit Groups
      summary: List Chit Groups
      description: |
        Retrieve chit groups.
        
        **Access:**
        - **Super Admin:** Can view all groups, optionally filtered by organisationId
        - **Org Admin:** Automatically filtered to their organisation's groups only
      parameters:
        - name: organisationId
          in: query
          description: Filter by organisation (Super Admin only)
          schema:
            type: string
      responses:
        '200':
          description: List of chit groups
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ChitGroup'
        '401':
          description: Unauthorized

    post:
      tags:
        - üè¢ Org Admin - Chit Groups
      summary: Create Chit Group
      description: |
        Create a new chit group.
        
        **Access:**
        - **Super Admin:** Must provide organisationId
        - **Org Admin:** Organisation is automatically set from user profile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateChitGroupRequest'
      responses:
        '201':
          description: Chit group created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChitGroup'
        '400':
          description: Invalid request or missing organisation
        '401':
          description: Unauthorized

  /chitgroups/{id}:
    get:
      tags:
        - üè¢ Org Admin - Chit Groups
      summary: Get Chit Group by ID
      description: |
        Retrieve a specific chit group. The currentPeriod is automatically updated based on the start date and frequency.
        
        **Access:** All authenticated users
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Chit group data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChitGroup'
        '401':
          description: Unauthorized
        '404':
          description: Group not found

    put:
      tags:
        - üè¢ Org Admin - Chit Groups
      summary: Update Chit Group
      description: |
        Update a chit group's information.
        
        **Access:** All authenticated users
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateChitGroupRequest'
      responses:
        '200':
          description: Group updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  group:
                    $ref: '#/components/schemas/ChitGroup'
        '401':
          description: Unauthorized
        '404':
          description: Group not found

    delete:
      tags:
        - üè¢ Org Admin - Chit Groups
      summary: Delete Chit Group
      description: |
        Delete a chit group and all related data (collections, winners, group members).
        
        **Access:** All authenticated users
        
        **Warning:** This is a cascading delete operation.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Group and related data deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  deletedGroupId:
                    type: string
        '401':
          description: Unauthorized
        '404':
          description: Group not found

  /chitgroups/{id}/clone:
    post:
      tags:
        - üè¢ Org Admin - Chit Groups
      summary: Clone Chit Group
      description: |
        Create a copy of an existing chit group with reset period and status.
        
        **Access:** All authenticated users
        
        The cloned group will have:
        - Name suffixed with "(Copy)"
        - Start date set to current date
        - Current period reset to 1
        - Status set to ACTIVE
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '201':
          description: Group cloned successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  clonedGroup:
                    $ref: '#/components/schemas/ChitGroup'
        '401':
          description: Unauthorized
        '404':
          description: Original group not found

  # =====================================================
  # MEMBERS (BOTH ROLES - SCOPED)
  # =====================================================
  /members:
    get:
      tags:
        - üè¢ Org Admin - Members
      summary: List Members
      description: |
        Retrieve members.
        
        **Access:**
        - **Super Admin:** Can view all members
        - **Org Admin:** Automatically filtered to their organisation's members only
      responses:
        '200':
          description: List of members
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Member'
        '401':
          description: Unauthorized

    post:
      tags:
        - üè¢ Org Admin - Members
      summary: Create Member
      description: |
        Create a new member.
        
        **Access:**
        - **Super Admin:** Must provide organisationId
        - **Org Admin:** Organisation is automatically set from user profile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateMemberRequest'
      responses:
        '201':
          description: Member created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Member'
        '400':
          description: Invalid request or missing organisation
        '401':
          description: Unauthorized

  /members/{id}:
    get:
      tags:
        - üè¢ Org Admin - Members
      summary: Get Member by ID
      description: |
        Retrieve a specific member by ID.
        
        **Access:** All authenticated users
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Member data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Member'
        '401':
          description: Unauthorized
        '404':
          description: Member not found

  # =====================================================
  # GROUP MEMBERS / SUBSCRIPTIONS (BOTH ROLES - SCOPED)
  # =====================================================
  /groupmembers:
    get:
      tags:
        - üè¢ Org Admin - Group Members (Subscriptions)
      summary: List Group Member Subscriptions
      description: |
        Retrieve member subscriptions to chit groups with dynamically calculated overdue amounts.
        
        **Access:**
        - **Super Admin:** Can view all subscriptions
        - **Org Admin:** Automatically filtered to their organisation's groups
      parameters:
        - name: groupId
          in: query
          description: Filter by group ID
          schema:
            type: string
        - name: memberId
          in: query
          description: Filter by member ID
          schema:
            type: string
      responses:
        '200':
          description: List of subscriptions with overdue information
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GroupMember'
        '401':
          description: Unauthorized

    post:
      tags:
        - üè¢ Org Admin - Group Members (Subscriptions)
      summary: Create Group Member Subscription
      description: |
        Enroll a member into a chit group. The totalDue and collectionFactor are automatically calculated.
        
        **Collection Factor Calculation:**
        - Monthly group + Daily pattern = 30
        - Monthly group + Weekly pattern = 4
        - Weekly group + Daily pattern = 7
        - Same or less granular pattern = 1
        
        **Access:** All authenticated users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGroupMemberRequest'
      responses:
        '201':
          description: Subscription created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GroupMember'
        '400':
          description: Invalid request
        '401':
          description: Unauthorized
        '404':
          description: Group not found

  # =====================================================
  # COLLECTIONS (BOTH ROLES - SCOPED)
  # =====================================================
  /collections:
    get:
      tags:
        - üè¢ Org Admin - Collections
      summary: List Collections
      description: |
        Retrieve payment collections.
        
        **Access:**
        - **Super Admin:** Can view all collections
        - **Org Admin:** Automatically filtered to their organisation's groups
      parameters:
        - name: groupMemberId
          in: query
          description: Filter by group member subscription ID
          schema:
            type: string
        - name: groupId
          in: query
          description: Filter by group ID
          schema:
            type: string
        - name: memberId
          in: query
          description: Filter by member ID
          schema:
            type: string
      responses:
        '200':
          description: List of collections
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Collection'
        '401':
          description: Unauthorized

    post:
      tags:
        - üè¢ Org Admin - Collections
      summary: Record Collection Payment
      description: |
        Record a payment collection for a member's subscription. The collection sequence is automatically determined, and subscription totals are updated.
        
        **Access:** All authenticated users
        
        **Automatic Updates:**
        - Collection sequence calculated based on existing collections for the period
        - Subscription's totalCollected and pendingAmount updated
        - Subscription status set to CLOSED if fully paid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCollectionRequest'
      responses:
        '201':
          description: Collection recorded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Collection'
        '400':
          description: Invalid request or all collections for period already recorded
        '401':
          description: Unauthorized

  # =====================================================
  # WINNERS (BOTH ROLES - SCOPED)
  # =====================================================
  /winners:
    get:
      tags:
        - üè¢ Org Admin - Winners (Draws)
      summary: List Winners
      description: |
        Retrieve draw winners.
        
        **Access:**
        - **Super Admin:** Can view all winners
        - **Org Admin:** Automatically filtered to their organisation's groups
      parameters:
        - name: groupId
          in: query
          description: Filter by group ID
          schema:
            type: string
        - name: groupMemberId
          in: query
          description: Filter by group member subscription ID
          schema:
            type: string
        - name: memberId
          in: query
          description: Filter by member ID
          schema:
            type: string
      responses:
        '200':
          description: List of winners
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Winner'
        '401':
          description: Unauthorized

    post:
      tags:
        - üè¢ Org Admin - Winners (Draws)
      summary: Record Winner
      description: |
        Record a winner for a chit group draw.
        
        **Access:**
        - **Super Admin:** Can create winners for any group
        - **Org Admin:** Can only create winners for groups in their organisation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateWinnerRequest'
      responses:
        '201':
          description: Winner recorded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Winner'
        '400':
          description: Missing required fields or invalid subscription
        '401':
          description: Unauthorized
        '403':
          description: Group does not belong to user's organisation

  # =====================================================
  # DASHBOARD (BOTH ROLES - SCOPED)
  # =====================================================
  /dashboard:
    get:
      tags:
        - üè¢ Org Admin - Dashboard
      summary: Get Dashboard Statistics
      description: |
        Retrieve dashboard statistics including active groups count, total collections, active members, pending dues, recent collections, and pending dues list.
        
        **Access:**
        - **Super Admin:** Statistics for all organisations
        - **Org Admin:** Statistics scoped to their organisation only
      responses:
        '200':
          description: Dashboard data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardResponse'
        '401':
          description: Unauthorized

  # =====================================================
  # REPORTS (BOTH ROLES - SCOPED)
  # =====================================================
  /reports:
    get:
      tags:
        - üè¢ Org Admin - Reports
      summary: Get Analytics Reports
      description: |
        Retrieve comprehensive analytics including collection trends, member distribution, payment mode statistics, recent transactions, and group performance.
        
        **Access:**
        - **Super Admin:** Analytics for all organisations
        - **Org Admin:** Analytics scoped to their organisation only
      responses:
        '200':
          description: Reports data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReportsResponse'
        '401':
          description: Unauthorized

  # =====================================================
  # SYSTEM ENDPOINTS
  # =====================================================
  /seed:
    post:
      tags:
        - üîß System Utilities
      summary: Seed Database
      description: |
        Create sample data for testing purposes. This endpoint clears existing data and creates:
        - Super Admin user (admin@gmail.com / Admin@123)
        - Sample chit groups
        - Sample members
        - Sample subscriptions
        
        **Access:** Public (No authentication required)
        
        **Warning:** This will DELETE all existing data!
      security: []
      responses:
        '200':
          description: Seed data created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  groups:
                    type: array
                    items:
                      $ref: '#/components/schemas/ChitGroup'
        '500':
          description: Seed failed

    delete:
      tags:
        - üîß System Utilities
      summary: Clear Database
      description: |
        Delete all data from the database (except users).
        
        **Access:** Public (No authentication required)
        
        **Warning:** This will DELETE all data!
      security: []
      responses:
        '200':
          description: Database cleared successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Database cleared successfully"
        '500':
          description: Clear operation failed
